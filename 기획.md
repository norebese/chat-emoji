자연어처리 프로젝트를 진행중이다
## 프로젝트 주제: 실시간 1:1 채팅을 바탕으로 자신과 상대방의 감정을 표현하는 이미지를 생성하여 프로필로 실시간으로 반영하여 보여주는 서비스

### 프론트엔드: streamlit, websocket
### 백엔드: fastapi, websocket, 다른 서버와의 api통신, 파파고 번역기 api

## 디렉토리 구조:
```commandline
root/
    client/
        app.py  # streamlit 파일
        ...
    server/
        main.py  # fastapi 파일
        utils/
            model_process.py # 문장 요약모델, 문장 감정 추론 모델
            pre_sentence.py # 형태소 분석 전처리
```

## 시퀀스 순서:

* 나를 A, 상대를 B라고 가정
* 각각이 입력한 채팅 내용은 따로 관리한다.
* 즉 감정에 대한 결과물은 A의 채팅만을 사용한 감정추론 결과물과, B의 채팅만을 사용한 감정추론 결과물. 이렇게 두 개의 결과물이 나온다.

1. A가 채팅을 입력한다.
2. 클라이언트에서 웹소켓을 통해 백엔드로 A가 작성한 채팅을 백엔드로 보낸다
3. 백엔드에서는 해당 채팅을 받은 후
4. 현재 프론트에서 넘어온 채팅을 pre_sentence의 형태소 분석기에 넣어 형태소 분석을 한다
5. 웹소켓 대화봥 채팅에 프론트에서 넘어온 채팅 메시지를 업데이트 한다
6. 만약 형태소 분석기의 결과가 동사에 관한 형태소라 판단할 경우
   1. 동사를 기준으로 문장을 나눈다. 
   2. 현재까지 usertext 리스트에 저장된 모든 문장들을 하나의 문자열로 결합한다. 
   3. 결합된 문자열을 textlist 리스트에 추가한다. 
   4. usertext 리스트를 초기화한다. 
   5. 현재 문장 중 동사 이후 부분이 있다면, 이를 새로운 usertext 리스트의 첫 요소로 추가한다.
   * 아닐 경우:
     1. usertext 리스트에 현재 프론트에서 넘오은 채팅을 넣는다.
6. 웹소켓의 message의 채팅 내역 디스플레이 리스트에 해당 채팅을 추가하여 다른 클라이언트들에게 동일한 내용이 보이게끔 이벤트를 발생시켜 업데이트한다.
7. 만약 textlist의 요소의 갯수가 5개이면 
8. 해당 5개의 문장들을 하나의 문자열로 합친 후 model_process.py에 있는 문장 요약 모델에 넣어 핵심 문장으로 요약한다.
9. 마찬가지로 핵심 문장으로 요약한 문장을 model_process.py의 감정 추론 모델에 넣어 감정 추론 결과를 반환한다. 
* 문장요약 모델과 감정추론 모델이 동작중이여도 유저의 채팅은 계속 수집되고 있고, usertext와 형태소 분석기는 계속 동작되어야 한다.  
10. 감정 추론 결과에서 상위의 3개의 감정을 적합도와 딕셔너리 형태의 자료형으로 가공하고, 3개의 감정과 요약된 문장을 papago 번역 api를 통해 한국어에서 영어로 번역한다.
11. 영어로 번역된 감정들과 요약된 문장을 AUTOMATIC1111이 만든 stable-diffusion-webui를 api 모드로 실행시킨 서버로 해당 api 양식에 맞춰 t2i를 하기 위한 양식으로 만든다.
12. 이떄 감정의 가중치 부분은 이전에 딕셔너리로 묶은 적합도 기준으로 가중치를 조절하는 표현으로 프롬프트 맨 처음에 넣어주고, 감정 3개가 프롬프트에 입력된 후 뒤에 영어로 번역된 요약된 문장이 들어간다.
13. 그후 stable-diffusion-webui로 생성한 이미지를 fastapi서버가 다시 받아 이것을 프론트엔드로 보내준다.







