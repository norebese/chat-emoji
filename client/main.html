<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Emotion Chat</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>
    <div class="header">
        <div class="profile_area_a"></div>
        <div class="profile_area_b"></div>
    </div>
    <div>
        <div class="chat_area">
            <!--채팅 로그는 이곳에 쌓입니다.-->
        </div>
        <form onsubmit="return sendMessage();">
            <input type="text" id="nameInput" placeholder="이름을 입력하세요">
            <input type="text" id="messageInput" placeholder="이곳을 눌러 채팅을 시작하세요!">
            <button type="submit">보내기</button>
        </form>
    </div>

    <script>
        let ws = new WebSocket("ws://localhost:8000/ws");
        let myName = ""; // 본인의 이름을 저장할 변수

        ws.onmessage = function(event) {
            let data = JSON.parse(event.data);
            let messageElement = document.createElement("div");

            if (data.sender === myName) {
                messageElement.className = "sent-message";
            } else {
                messageElement.className = "received-message";
            }

            messageElement.innerHTML = `<strong>${data.sender}:</strong> ${data.text}`;
            document.querySelector(".chat_area").appendChild(messageElement);
        };

        function sendMessage() {
            let nameInput = document.getElementById("nameInput");
            let messageInput = document.getElementById("messageInput");
            let name = nameInput.value.trim();
            let message = messageInput.value.trim();

            if (name === "") {
                alert("이름을 입력하세요!");
                return false;
            }

            if (message !== "") {
                myName = name; // 메시지를 보낼 때 본인의 이름을 저장
                // let messageElement = document.createElement("div");
                // messageElement.className = "sent-message";
                // messageElement.innerHTML = `<strong>${name}:</strong> ${message}`;
                // document.querySelector(".chat_area").appendChild(messageElement);

                let data = JSON.stringify({ sender: name, text: message });
                ws.send(data);
                messageInput.value = "";
            }
            return false; // Prevent form submission
        }
    </script>
</body>
</html>
